/*! wsc Built on: 2020-09-03 */
var wsc=function(a){"use strict";var b=a._private=a._private||{},c=b.wscConst,d=b.wscUtils,e=(b.CallCommonUtils,a.getLogger()),f=function(a,b){if(!a){var d="The parameter 'session' cannot be null!";throw e.error(d),d}this.session=a,b?this.packageType=b:this.packageType=c.PACKAGE.CAPABILITY,this.capabilityExchange=null,this.session.registerPackage(this)};f.prototype={createCapabilityExchange:function(){var a=new g;return a.session=this.session,a.pkgInstance=this,this.capabilityExchange=a,this.capabilityExchange},onMessage:function(a){null==this.capabilityExchange&&createCapabilityExchange(),this.capabilityExchange.onMessage(a)},toJSON:function(){var a={session:""};return d.toJSON(a,this)}};var g=function(a){var b=new d.Map;this.session=null,this.subSessionId=null,this.pkgInstance=null,a&&(this.session=a.session,this.subSessionId=a.subSessionId,this.pkgInstance=a.pkgInstance,a.setCapabilityExchange(this)),this.onQueryRequest=null,this.onQueryResponse=null,this.onError=null,this.cacheQuery=function(a,c){try{b.put(a,c)}catch(d){e.error("Put Query to map : "+d)}},this.removeQuery=function(a){try{b.remove(a)}catch(c){e.error("Remove Query from map:"+c)}}};g.prototype={enquiry:function(a,b){var e=new d.Message,f=null;f=this.subSessionId?this.subSessionId:this.session.generateSubSessionId(),e.control.package_type=this.pkgInstance.packageType,e.control.type=c.TYPE.REQUEST,e.control.subsession_id=f,e.header.action=c.ACTION.ENQUIRY,e.header.enquiry_data=a,e.header.initiator=this.session.userName,e.header.target=b;var g=new h(f,this.session.userName,b,a);this.cacheQuery(f,g),this.session.sendMessage(e)},respond:function(a,b){var e=new d.Message,f=this.session.lastInboundSeq;e.control.package_type=this.pkgInstance.packageType,e.control.type=c.TYPE.RESPONSE,e.control.subsession_id=a.ssid,e.control.message_state=c.MESSAGESTATE.FINAL,e.control.correlation_id=a.correlationId,e.control.ack_sequence=f,e.header.action=c.ACTION.ENQUIRY,e.header.enquiry_data=b,e.header.initiator=a.initiator,e.header.target=a.target,this.session.sendMessage(e),this.removeQuery(a.ssid)},onMessage:function(a){var b=a.control.subsession_id;if(a.isRequest()){var c=new h(b,a.header.initiator,a.header.target,a.header.enquiry_data);c.correlationId=a.control.correlation_id,this.cacheQuery(b,c),this.onQueryRequest&&this.onQueryRequest(c)}else if(a.isResponse()){var c=new h(b,a.header.initiator,a.header.target);c.targetCapability=a.header.enquiry_data,this.onQueryResponse&&this.onQueryResponse(c),this.removeQuery(b)}else a.isACK()||a.isError()&&this.onError&&this.onError({action:a.header.action,errorCode:a.header.error_code,errorReason:a.header.reason})},toJSON:function(){var a={session:"",pkgInstance:""};return d.toJSON(a,this)}};var h=function(a,b,c,d){this.ssid=a,this.initiator=b,this.target=c,d&&(this.initiatorCapability=d),this.targetCapability=null,this.correlationId=null};return a.CapabilityPackage=f,a.CapabilityExchange=g,console.log("wsc-CapabilityPackage initialized."),a}(wsc||{});