/*! wsc Built on: 2020-09-03 */
function getMediaOptions(){var a={};if("undefined"!=typeof swfobject){var b=swfobject&&swfobject.getFlashPlayerVersion&&swfobject.getFlashPlayerVersion();b=b?b.major+"."+b.minor+"."+b.release:null}var c="undefined"!=typeof b;a.flash=c,wsclogger.log("Flash present? "+c);var d=webrtc&&webrtc.isSupported&&webrtc.isSupported();return wsclogger.log("WebRTC present? "+d),a.webrtc=d,a}function SessionExtension(){SessionExtension.superclass.constructor.apply(this,arguments)}if(wsc_flash="undefined"==typeof wsc_flash?{}:wsc_flash,"undefined"!=typeof wsc?(wsclogger=wsc._private.wscUtils.getLogger(),wsclogger.info("wsc_flash wired to WebRTC Session Controller logger")):wsclogger=console,wsc_flash.wscFlash="undefined"==typeof wsc_flash.wscFlash?{}:wsc_flash.wscFlash,wsc_flash._findScriptBaseURL=function(a){var b=void 0,c=document.getElementsByTagName("script");if(c)for(var d=0,e=c.length;e>d&&!b;d++){var f=c[d],g=f?f.src:void 0,h=g&&g.length>a.length?g.substr(g.length-a.length):void 0;h==a&&(b=g.substr(0,g.length-a.length))}return b},wsc_flash.external="undefined"==typeof wsc_flash.external?{}:wsc_flash.external,wsc_flash.external.JSON=window.JSON,wsc_flash.external.toString=function(a){var b=void 0;try{b=wsc_flash.external.JSON&&wsc_flash.external.JSON.stringify?wsc_flash.external.JSON.stringify(a):wsc_flash.util._toString(a)}catch(c){b=a}return b},wsc_flash.log="undefined"==typeof wsc_flash.log?{}:wsc_flash.log,window.webphone={log:function(a){wsc_flash.log.info(a),webphone.append(a)},error:function(a){wsc_flash.log.error(a),webphone.append(a)},append:function(a){}},wsc_flash.log.getCallerName=function(a){var b=a&&a.prototype&&a.prototype._function;return b||(b="anonymous"),b},wsc_flash.log.debug=function(a){var b=wsc_flash.log.getCallerName(wsc_flash.log.debug.caller);wsclogger.debug(b+" | "+a)},wsc_flash.log.info=function(a){var b=wsc_flash.log.getCallerName(wsc_flash.log.info.caller);wsclogger.info(b+" | "+a)},wsc_flash.log.warn=function(a){var b=wsc_flash.log.getCallerName(wsc_flash.log.warn.caller);wsclogger.warn(b+" | "+a)},wsc_flash.log.error=function(a,b){var c=wsc_flash.log.getCallerName(wsc_flash.log.error.caller);wsclogger.error(c+" | "+a),b&&b.stack&&wsclogger.error(c+" | "+b.stack)},wsc_flash.exception="undefined"==typeof wsc_flash.exception?{}:wsc_flash.exception,wsc_flash.exception.Exception=function(a,b){return a&&wsc_flash.log.error('Constructing exception for "'+a+'"'),this.message=a,this.cause=b,this},wsc_flash.exception.Exception.prototype=new Error,wsc_flash.exception.Exception.prototype.toString=function(){return this.message},wsc_flash.util="undefined"==typeof wsc_flash.util?{}:wsc_flash.util,wsc_flash.util._toString=function(a){var b;if(a){b="{";for(p in a){var c=a[p];"function"!=typeof c&&(b+="object"==typeof c?p+":"+wsc_flash.util._toString(c):p+":"+c+";")}b+="}"}else b="undefined";return b},wsc_flash.util._tagModule=function(a,b){if(a){a._module=b;for(var c in a){var d=a[c];if(d){d._module||(d._module=b);var e=typeof d;"function"!=e||d.prototype._function?"object"==e&&wsc_flash.util._tagModule(d,b+"."+c):d.prototype._function=b+"."+c,d.prototype&&wsc_flash.util._tagModule(d.prototype,b+"."+c)}}a.prototype&&wsc_flash.util._tagModule(a.prototype,b+"."+c)}},wsc_flash.util.getQueryParameter=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null==c?void 0:decodeURIComponent(c[1].replace(/\+/g," "))},wsc_flash.util.getRelativeUrl=function(a){var b=location.protocol+"//"+location.hostname+(location.port&&":"+location.port)+location.pathname,c=b.lastIndexOf("/");return c<b.length-1&&(b=b.substring(0,c)+"/"),a&&(b+=a),"/"!=b.charAt(b.length-1)&&(b+="/"),wsc_flash.log.debug("Relative path for '"+a+"' is "+b),b},wsc_flash.browser="undefined"==typeof wsc_flash.browser?{}:wsc_flash.browser,wsc_flash.browser.isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,wsc_flash.browser.isFirefox="undefined"!=typeof InstallTrigger,wsc_flash.browser.isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,wsc_flash.browser.isChrome=!!window.chrome&&!wsc_flash.browser.isOpera,wsc_flash.browser.isIE=!1,wsc_flash.browser.IEversion=null,-1!=navigator.userAgent.indexOf("MSIE"))var ie_regexp=/MSIE (\d+\.\d+);/;else var ie_regexp=/Trident.*rv[ :]*(\d+\.\d+)/;ie_regexp.test(navigator.userAgent)&&(wsc_flash.browser.isIE=!0,wsc_flash.browser.IEversion=new Number(RegExp.$1),wsclogger.log("Browser is IE, version "+wsc_flash.browser.IEversion)),wsc_flash.wscFlash.init=function(){wsc_flash.log.debug("Initializing");var a=swfobject&&swfobject.getFlashPlayerVersion&&swfobject.getFlashPlayerVersion();a=a?a.major+"."+a.minor+"."+a.release:null;var b="undefined"!=typeof a;b?(wsc_flash.log.debug("Flash present? "+b),"undefined"!=typeof wsc?(wsc=function(a){"use strict";var b=a._private=a._private||{};return a.FlashCall=function(){a.FlashCall.superclass.constructor.apply(this,arguments);var c={RTCPeerConnection:window.RTCPeerConnection,getUserMedia:navigator.getUserMedia},d={RTCPeerConnection:wsc_flash.wscFlash.RTCPeerConnection,getUserMedia:wsc_flash.wscFlash.getUserMedia};this.wedge=function(a){for(var c in a)b[c]=a[c]},this.startWedge=function(){this.wedge(d)},this.stopWedge=function(){this.wedge(c)}},a.extend(a.FlashCall,a.Call),a.FlashCall.prototype.start=function(b,c){try{this.startWedge(),a.FlashCall.superclass.start.apply(this,[b,c])}finally{this.stopWedge()}},a.FlashCall.prototype.accept=function(b,c,d){try{this.startWedge(),a.FlashCall.superclass.accept.apply(this,[b,c,d])}finally{this.stopWedge()}},a.FlashCall.prototype.getDataTransfer=function(a){throw"Data channel is not supported for Flash calls"},a.FlashCall.prototype.update=function(b,c,d){try{this.startWedge(),a.FlashCall.superclass.update.apply(this,[b,c,d])}finally{this.stopWedge()}},a.FlashCallPackage=function(b){a.FlashCallPackage.superclass.constructor.apply(this,[b,"flash"])},a.extend(a.FlashCallPackage,a.CallPackage),a.FlashCallPackage.prototype.prepareCall=function(b,c,d,e){return new a.FlashCall(b,c,d,e)},a.FlashCallPackage.prototype.setTrickleIceMode=function(a){if("undefined"!=typeof a&&"off"!=a)throw"Trickle ICE is not supported for Flash based calls"},a}(wsc||{}),wsc_flash.log.debug("WebRTC Session Controller configured to use Flash media")):wsc_flash.log.debug("No WebRTC Session Controller API found to integrate with, WebRTC Session Controller Flash is not supported."),"undefined"==typeof window.RTCSessionDescription&&(wsc_flash.log.debug("No native RTCSessionDescription. Providing one."),window.RTCSessionDescription=wsc_flash.wscFlash.RTCSessionDescription)):wsc_flash.log.debug("Flash is not present so not overriding the WebRTC Session Controller API"),wsc_flash.log.debug("Initialization complete")},wsc_flash.wscFlash.RTCSessionDescription=function(a){return wsc_flash.log.debug("Created Flash RTCSessionDescription for "+JSON.stringify(a)),this.sdp=a?a.sdp:void 0,this.type=a?a.type:void 0,this},wsc_flash.wscFlash.RTCSessionDescription.prototype.toString=function(){return"RTCSessionDescription["+JSON.stringify(this)+"]"},wsc_flash.wscFlash.MediaStream=function(){return this.audioTracks=[],this.videoTracks=[],wsc_flash.log.debug("Created "+this),this},wsc_flash.wscFlash.MediaStream.prototype.getAudioTracks=function(){return wsc_flash.log.debug("Get MediaStream audio tracks for "+this),this.audioTracks},wsc_flash.wscFlash.MediaStream.prototype.getVideoTracks=function(){return wsc_flash.log.debug("Get MediaStream video tracks for "+this),this.videoTracks},wsc_flash.wscFlash.MediaStream.prototype.toString=function(){return"MediaStream["+JSON.stringify(this)+"]"},wsc_flash.wscFlash.MediaStream.prototype.stop=function(){wsc_flash.log.debug("Stopped MediaStream "+this)},wsc_flash.wscFlash.MediaStreamTrack=function(){return this.enabled=!0,this.kind="Flash",this.id="FlashStream",this.label="FlashStreamLabel",this.muted=!1,this._readonly=!0,this.remote=!1,wsc_flash.log.debug("Created "+this),this},wsc_flash.wscFlash.MediaStreamTrack.prototype.toString=function(){return"MediaStreamTrack["+JSON.stringify(this)+"]"},wsc_flash.wscFlash.MediaStreamTrack.prototype.stop=function(){wsc_flash.log.debug("Stop "+this)},wsc_flash.wscFlash.MediaStreamEvent=function(a){return this.stream=a,wsc_flash.log.debug("Created "+this),this},wsc_flash.wscFlash.MediaStreamEvent.prototype.toString=function(){return"MediaStreamEvent["+JSON.stringify(this)+"]"},wsc_flash.wscFlash.FlashMediaStreamTrack=function(){return wsc_flash.wscFlash.MediaStreamTrack.apply(this,[]),wsc_flash.log.debug("Created "+this),this},wsc_flash.wscFlash.FlashMediaStreamTrack.prototype=new wsc_flash.wscFlash.MediaStreamTrack,wsc_flash.wscFlash.FlashMediaStreamTrack.prototype.toString=function(){return"FlashMediaStreamTrack["+JSON.stringify(this)+"]"},wsc_flash.wscFlash.FlashMediaStream=function(a,b,c,d,e,f){return wsc_flash.wscFlash.MediaStream.apply(this,[]),this.type="undefined"==typeof a?"flash":a,this.url=b,this.audioCodec=c,this.videoCodec=d,this.streamName=e,this.local="undefined"==typeof f?!0:f,"undefined"!=typeof c&&this.getAudioTracks().push(new wsc_flash.wscFlash.FlashMediaStreamTrack),"undefined"!=typeof d&&this.getVideoTracks().push(new wsc_flash.wscFlash.FlashMediaStreamTrack),wsc_flash.log.debug("Created "+this),this},wsc_flash.wscFlash.FlashMediaStream.prototype=new wsc_flash.wscFlash.MediaStream,wsc_flash.wscFlash.FlashMediaStream.prototype.isLocal=function(){return this.local},wsc_flash.wscFlash.FlashMediaStream.prototype.toString=function(){return"FlashMediaStream["+JSON.stringify(this)+"]"},wsc_flash.wscFlash.RTCPeerConnection=function(a,b){return this.config=a,this.constraints=b,this.remoteStreams=[],this.localStreams=[],this._sdp={session:"v=0\r\ns=Flash\r\ni=Flash\r\no=Flash\r\nc=IN IP4 192.168.255.255\r\nt=0 0\r\n",audio:"m=audio 21604 RTP/AVP 0 101\r\na=rtpmap:0 PCMU/8000\r\na=sendrecv\r\n",video:"m=video 21605 RTP/AVP 117\r\na=rtpmap:117 h264/90000\r\na=sendrecv\r\n"},wsc_flash.log.debug("Created "+this),this},wsc_flash.wscFlash.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},wsc_flash.wscFlash.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams},wsc_flash.wscFlash.RTCPeerConnection.prototype.createOffer=function(a,b,c){wsc_flash.log.debug("Create Flash RTCPeerConnection offer with "+JSON.stringify(c)+" for "+JSON.stringify(this));var d=this.getLocalStreams();if(d&&d.length>0){for(var e=[],f=[],g=0,h=d.length;h>g;g++){var i=d[g],j=i&&i.getAudioTracks();if(j)for(var k=0,l=j.length;l>k;k++){var m=j[k];m&&e.push(m)}var n=i&&i.getVideoTracks();if(n)for(var k=0,l=n.length;l>k;k++){var o=n[k];o&&f.push(o)}}var p=e.length>0,q=f.length>0;if(wsc_flash.log.debug("Offer should include audio? "+p+" video? "+q),"function"==typeof a){var r=new wsc_flash.wscFlash.RTCSessionDescription({type:"offer",sdp:this._sdp.session+(p?this._sdp.audio:"")+(q?this._sdp.video:"")});a(r)}}else b("There are no local streams")},wsc_flash.wscFlash.RTCPeerConnection.prototype._hasMedia=function(a,b){var c=!1;if("undefined"!=typeof a)for(var d,e=/^m=(audio|video)/gm;null!=(d=e.exec(a));)if(d[1]==b){c=!0;break}return wsc_flash.log.debug("Has media "+b+"? "+c),c},wsc_flash.wscFlash.RTCPeerConnection.prototype._hasAudio=function(a){return this._hasMedia(a,"audio")},wsc_flash.wscFlash.RTCPeerConnection.prototype._hasVideo=function(a){return this._hasMedia(a,"video")},wsc_flash.wscFlash.RTCPeerConnection.prototype.createAnswer=function(a,b,c){wsc_flash.log.debug("Create Flash RTCPeerConnection answer with "+JSON.stringify(c)+" for "+JSON.stringify(this));var d=!0,e=!0;if("undefined"!=typeof this.remoteDescription&&"undefined"!=typeof this.remoteDescription.sdp&&(d=this._hasAudio(this.remoteDescription.sdp),e=this._hasVideo(this.remoteDescription.sdp)),wsc_flash.log.debug("Answer should include audio? "+d+" video? "+e),"function"==typeof a){var f=new wsc_flash.wscFlash.RTCSessionDescription({type:"answer",sdp:this._sdp.session+(d?this._sdp.audio:"")+(e?this._sdp.video:"")});f.sdp=this.remoteDescription.sdp,a(f)}},wsc_flash.wscFlash.RTCPeerConnection.prototype.addStream=function(a){wsc_flash.log.debug("Adding Flash RTCPeerConnection stream "+a),a instanceof wsc_flash.wscFlash.MediaStream||wsc_flash.log.error("Adding Flash RTCPeerConnection stream should only occur with the MediaStream type!"),a.isLocal()&&this.getLocalStreams().push(a)},wsc_flash.wscFlash.RTCPeerConnection.prototype.removeStream=function(a){wsc_flash.log.debug("Removing Flash RTCPeerConnection stream "+a),a instanceof wsc_flash.wscFlash.MediaStream||wsc_flash.log.error("Removing Flash RTCPeerConnection stream should only occur with the MediaStream type!");var b=a.isLocal()?this.getLocalStreams():this.getRemoteStreams();if("undefined"!=typeof b)for(var c=0,d=b.length;d>c;c)if(a==b[c]){b.splice(c,1),a.isLocal()||"function"!=typeof this.onremovestream||this.onremovestream(a);break}},wsc_flash.wscFlash.RTCPeerConnection.prototype.close=function(){wsc_flash.log.debug("Close Flash RTCPeerConnection")},wsc_flash.wscFlash.RTCPeerConnection.prototype.setLocalDescription=function(a,b,c){wsc_flash.log.debug("Set local Flash RTCPeerConnection description to "+a),this.localDescription=a,"function"==typeof b&&(wsc_flash.log.debug("Set local Flash RTCPeerConnection description success callback"),b()),"function"==typeof this.onicecandidate&&(wsc_flash.log.debug("Set local Flash RTCPeerConnection description causing onicecandidate callback"),this.onicecandidate({candidate:null}))},wsc_flash.wscFlash.RTCPeerConnection.prototype.setRemoteDescription=function(a,b,c){wsc_flash.log.debug("Set remote Flash RTCPeerConnection description to "+a),this.remoteDescription=a;for(var d,e=/^a=x-me-([a-z]*)-stream:((audio|video)=(\w+)\s+)?((audio|video)=(\w+)\s+)?(.*)\/(.*)$/gm;null!=(d=e.exec(a.sdp));){var f=d[1],g=d[4],h=d[7],i=d[8],j=d[9].trim();if(wsc_flash.log.debug("Got RTMP stream type "+f+" pointed at "+i+" using "+g+"/"+h+" for stream "+j),"publish"==f){var k=this.getLocalStreams(),l=k&&k.length>0?k[0]:void 0;l?(wsc_flash.log.debug("Setting properties on existing local stream for RTMP type "+f),l.type=f,l.url=i,l.audioCodec=g,l.videoCodec=h,l.streamName=j):(wsc_flash.log.debug("Adding new local stream for RTMP type "+f),this.getLocalStreams().push(new wsc_flash.wscFlash.FlashMediaStream(f,i,g,h,j,!0)))}else if("subscribe"==f){var l=new wsc_flash.wscFlash.FlashMediaStream(f,i,g,h,j,!1);if(this.getRemoteStreams().push(l),"function"==typeof this.onaddstream)try{this.onaddstream(new wsc_flash.wscFlash.MediaStreamEvent(l))}catch(m){wsc_flash.log.error("Failed during onaddstream callback: "+m)}}else wsc_flash.log.error("Unknown stream type "+f+" found for Flash media")}wsc_flash.log.debug("Got setRemoteDescription RTMP Local Streams "+JSON.stringify(this.getLocalStreams())+" RTMP Remote Streams "+JSON.stringify(this.getRemoteStreams())),0==this.getLocalStreams().length&&wsc_flash.log.error("No local streams have been set in from SDP: "+a.sdp),0==this.getRemoteStreams().length&&wsc_flash.log.error("No remote streams have been set in from SDP: "+a.sdp),"function"==typeof b&&(wsc_flash.log.debug("Set remote Flash RTCPeerConnection description success callback"),b()),"function"==typeof this.onicecandidate&&(wsc_flash.log.debug("Set remote Flash RTCPeerConnection description causing onicecandidate callback"),this.onicecandidate({candidate:null}))},wsc_flash.wscFlash.RTCPeerConnection.prototype.toString=function(){return"RTCPeerConnection["+JSON.stringify(this)+"]"},wsc_flash.wscFlash.getUserMedia=function(a,b,c){if(wsc_flash.log.debug("Using Flash media: get user media is interactive"),"function"==typeof b){var d="undefined"==typeof a||"undefined"==typeof a.audio?!0:a.audio,e="undefined"==typeof a||"undefined"==typeof a.video?!0:a.video;wsc_flash.log.debug("Get user media should include audio? "+d+" video? "+e);var f=new wsc_flash.wscFlash.FlashMediaStream("flash",void 0,d?"pcmu":void 0,e?"h264":void 0,"getUserMediaPseudoStream");b(f)}},webrtc="undefined"==typeof webrtc?{}:webrtc,window.webkitRTCPeerConnection?webrtc._RTCPeerConnection=window.webkitRTCPeerConnection:window.mozRTCPeerConnection?webrtc._RTCPeerConnection=window.mozRTCPeerConnection:window.RTCPeerConnection&&(webrtc._RTCPeerConnection=window.RTCPeerConnection),wsc_flash.browser.isChrome&&(webrtc._RtcPeerConnectionConstraints={optional:[{DtlsSrtpKeyAgreement:"true"},{RtpDataChannels:"true"}]}),webrtc.isSupported=function(){return"undefined"!=typeof webrtc._RTCPeerConnection},wsclogger.log("webRTC is supported ?"+webrtc.isSupported()),void 0!==browserIsIE&&browserIsIE&&(wsc&&wsc._private.rtcHelper.getLocalStreams instanceof Function&&(wsc._private.rtcHelper.getLocalStreams=function(a){try{if(navigator.mozGetUserMedia){if(a.getSenders){var b=new MediaStream;return a.getSenders().forEach(function(a){b.addTrack(a.track)}),[b]}return a.localStreams}if(navigator.webkitGetUserMedia){var b=new MediaStream;return a.getSenders().forEach(function(a){b.addTrack(a.track)}),[b]}if(browserIsIE){var b=new MediaStream;return a.getSenders().forEach(function(a){b.addTrack(a.track)}),[b]}return null}catch(c){return wsclogger.error(c),null}}),wsc&&wsc._private.rtcHelper.getRemoteStreams instanceof Function&&(wsc._private.rtcHelper.getRemoteStreams=function(a){try{if(navigator.mozGetUserMedia){if(a.getReceivers){var b=new MediaStream;return a.getReceivers().forEach(function(a){b.addTrack(a.track)}),[b]}return a.RemoteStreams}if(navigator.webkitGetUserMedia){var b=new MediaStream;return a.getReceivers().forEach(function(a){b.addTrack(a.track)}),[b]}if(browserIsIE){var b=new MediaStream;return a.getReceivers().forEach(function(a){b.addTrack(a.track)}),[b]}return null}catch(c){return wsclogger.error(c),null}}),IEversion<=9&&(wsc.extend(SessionExtension,wsc.Session),SessionExtension.prototype.saveToStorage=function(){if(this.sessionState!==wsc.SESSIONSTATE.CLOSED&&this.sessionState!==wsc.SESSIONSTATE.FAILED&&this.sessionState!==wsc.SESSIONSTATE.RELOADING)if("undefined"!=typeof sessionStorage){if(this.sessionId){var a=this.sessionId,b=JSON.stringify(this);try{sessionStorage.getItem(a)&&sessionStorage.removeItem(a),sessionStorage.setItem(a,b)}catch(c){sessionHelper.invokeSessionError(this,my.ERRORCODE.SAVE_FAILED,e1)}}}else wsclogger.warn("Sorry, web storage is not supported...")},wsc.Session=SessionExtension));